import { Component, Input, OnInit, signal } from '@angular/core';
import { CommonModule } from '@angular/common';
import { HeatmapData } from '../security.model';

@Component({
  selector: 'app-vulnerability-heatmap',
  standalone: true,
  imports: [CommonModule],
  templateUrl: './vulnerability-heatmap.component.html',
  styleUrls: ['./vulnerability-heatmap.component.scss']
})
export class VulnerabilityHeatmapComponent implements OnInit {
  @Input({ required: true }) heatmapData: HeatmapData[] = [];
  
  maxScore = signal(100);

  ngOnInit() {
    if (this.heatmapData.length > 0) {
      this.maxScore.set(Math.max(...this.heatmapData.map(d => d.score)));
    }
  }

  getSeverityColor(score: number): string {
    const normalizedScore = score / this.maxScore();
    if (normalizedScore > 0.75) return 'var(--color-severity-high)';
    if (normalizedScore > 0.4) return 'var(--color-severity-medium)';
    if (normalizedScore > 0) return 'var(--color-severity-low)';
    return 'var(--color-text-secondary)'; // No vulnerabilities
  }

  getTooltipText(data: HeatmapData): string {
    return `${data.file}: ${data.score} vulnerabilities`;
  }
}
