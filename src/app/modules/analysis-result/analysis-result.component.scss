@use '../../../styles/variables' as v;
@use '../../../styles/mixins' as m;
@use '../../../styles/theme' as t;
@use '../../../styles/animations' as a; // Corrected import path for animations

:host {
  display: block;
  padding: var(--space-xl);
  background-color: var(--color-bg-primary);
  color: var(--color-text-primary);
  transition: background-color 0.3s ease, color 0.3s ease;
}

.analysis-page-container {
  display: flex;
  flex-direction: column;
  gap: var(--space-2xl);
  max-width: 1800px;
  margin: 0 auto;

  @include m.breakpoint-down(lg) {
    gap: var(--space-xl);
    padding: var(--space-md);
  }
}

.analysis-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  flex-wrap: wrap;
  gap: var(--space-lg);
  margin-bottom: var(--space-xl);
  padding: var(--space-md);
  border-bottom: 1px solid var(--color-border-neutral);

  .header-content {
    .page-title {
      font-size: var(--font-size-display-title);
      font-weight: var(--font-weight-heavy);
      color: var(--color-text-primary);
      margin-bottom: var(--space-xs);

      @include m.breakpoint-down(md) {
        font-size: var(--font-size-page-title);
      }

      .project-name-highlight {
        color: var(--color-primary-indigo-600);
      }
    }

    .job-id-display {
      font-size: var(--font-size-body-md);
      color: var(--color-text-muted);
      margin-bottom: var(--space-sm);
    }

    .analysis-summary-overview {
      display: flex;
      gap: var(--space-lg);
      font-size: var(--font-size-body-md);

      .analysis-date {
        color: var(--color-text-muted);
      }

    .overall-status {
      font-weight: var(--font-weight-bold);
      padding: var(--space-xxs) var(--space-sm); /* Adjusted padding */
      border-radius: var(--border-radius-pill);
      display: inline-flex; /* Use flex for alignment */
      align-items: center;
      gap: v.$space-xs; /* Gap between dot and text */
      transition: all 0.3s ease;

      .status-dot {
        display: block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: currentColor; /* Use text color for dot */
        box-shadow: 0 0 5px currentColor; /* Subtle glow */
        animation: pulse 1.5s infinite ease-in-out; /* Use pulse from animations */
      }

      &.status-success {
        background-color: rgba(var(--success-color-rgb-channels), 0.2); /* Use RGB channels */
        color: var(--success-color);
      }
      &.status-warning {
        background-color: rgba(var(--warning-color-rgb-channels), 0.2); /* Use RGB channels */
        color: var(--warning-color);
      }
      &.status-error {
        background-color: rgba(var(--error-color-rgb-channels), 0.2); /* Use RGB channels */
        color: var(--error-color);
      }
    }
  }
}

  .header-actions {
    .back-to-project-btn {
      @include m.button-primary;
      background-color: var(--color-bg-secondary);
      color: var(--color-text-primary);
      border: 1px solid var(--color-border-neutral);
      padding: var(--space-sm) var(--space-lg);
      text-decoration: none;

      &:hover {
        background-color: var(--color-bg-secondary-hover);
        box-shadow: var(--shadow-sm);
      }
    }
  }
}

.analysis-main-grid {
  display: grid;
  grid-template-columns: 1fr 2fr 1.5fr; /* File tree, findings list, code viewer */
  gap: var(--space-2xl);
  align-items: flex-start; /* Align items to the top */

  @include m.breakpoint-down(xl) {
    grid-template-columns: 1fr 1fr; /* Two columns on large tablets */
  }

  @include m.breakpoint-down(md) {
    grid-template-columns: 1fr; /* Single column on mobile */
    gap: var(--space-xl);
  }

  .left-panel-container,
  .center-panel-container,
  .right-panel-container {
    display: flex;
    flex-direction: column;
    gap: var(--space-xl);

    @include m.breakpoint-down(xl) {
      &:last-child:not(:first-child) { // right-panel on second row for tablet
        grid-column: span 2;
      }
    }
    @include m.breakpoint-down(md) {
      grid-column: auto;
    }
  }

  .card {
    @include m.glass-card; /* Apply premium glassmorphism */
    padding: var(--space-xl);
    height: 100%; /* Ensure cards fill their container */
    @include a.hover-lift-glow(); /* Apply standard hover lift and glow */

    .section-title {
      font-size: var(--font-size-section-title);
      font-weight: var(--font-weight-bold);
      color: var(--text-primary);
      margin-bottom: var(--space-xl);
    }
  }

  .file-tree-section {
    min-height: 400px;
    // Specific styles for file tree if needed
  }

  .severity-filter-section {
    // Specific styles for severity filter if needed
  }

  .issue-breakdown-section {
    .issue-breakdown-chart-container,
    .chart-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 250px;
      background: linear-gradient(135deg, rgba(var(--color-bg-primary-navy-black), 0.05) 0%, rgba(var(--color-bg-secondary), 0.05) 100%);
      border-radius: var(--border-radius-card);
      border: 1px solid rgba(var(--color-border-neutral), 0.4);
      color: var(--color-text-muted);
      text-align: center;
      padding: v.$space-l;
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: var(--shadow-glass-light), var(--shadow-glass-dark);
      gap: v.$space-md; /* Gap between chart visual and legend/messages */

      .chart-visual {
        width: 150px;
        height: 150px;
        position: relative;

        .pie-chart-svg {
          width: 100%;
          height: 100%;
          transform: rotate(-90deg);

          circle {
            transition: stroke-dashoffset 0.5s ease-out, stroke 0.3s ease;
            filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
            &:hover {
              filter: drop-shadow(0 0 10px var(--color-accent-cyan-400));
              cursor: pointer;
            }
          }
          .chart-center-text {
            font-family: v.$font-family-secondary;
            font-size: 1.25rem; /* Adjusted for better legibility */
            font-weight: v.$font-weight-bold;
            fill: var(--color-text-primary);
            text-shadow: 0 0 8px rgba(var(--accent-color-rgb-channels), 0.6);
            transition: fill 0.3s ease;
          }
        }
      }

      .chart-legend {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: v.$space-md v.$space-lg; /* Spacing between legend items */
        margin-top: v.$space-sm;

        .legend-item {
          display: flex;
          align-items: center;
          gap: v.$space-xs;
          font-size: var(--font-size-body-sm);
          color: var(--color-text-primary);

          .legend-color {
            display: block;
            width: 12px;
            height: 12px;
            border-radius: var(--border-radius-sm);
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3); /* Subtle shadow for color box */
          }
        }
      }

      .chart-placeholder-message {
        font-size: var(--font-size-body-md);
        margin-bottom: v.$space-xs;
        font-style: italic;
        color: var(--color-text-primary);
      }
      .sub-message {
        font-size: var(--font-size-body-sm);
        color: var(--color-text-muted);
        opacity: 0.8;
      }
    }
  }

  .code-viewer-section {
    &.open {
      // Styles when code viewer is open/active
    }
    .empty-code-viewer {
      display: flex;
      flex-direction: column; /* Organize content vertically */
      align-items: center;
      justify-content: center;
      height: 100%;
      min-height: 300px;
      color: var(--text-muted);
      text-align: center;
      padding: v.$space-lg;

      .empty-code-viewer-icon {
        font-size: 3rem;
        color: var(--primary-light-color);
        margin-bottom: v.$space-md;
        text-shadow: 0 0 10px rgba(var(--primary-color-rgb-channels), 0.5);
      }

      p {
        font-size: var(--font-size-body-md);
        margin-bottom: v.$space-xs;
      }
      .sub-message {
        font-size: var(--font-size-body-sm);
        color: var(--text-muted);
        opacity: 0.8;
      }
    }
  }
}
